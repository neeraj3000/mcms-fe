workflows:
  build:
    name: Build APK for React Native
    steps:
      # Step 1: Install dependencies
      - name: Install dependencies
        run: |
          # Install Node.js
          nvm install 16
          nvm use 16

          # Install dependencies
          yarn install

      # Step 2: Set up Android environment
      - name: Set up Android environment
        run: |
          echo "sdk.dir=/opt/android-sdk-linux" > local.properties
          mkdir -p ~/.gradle
          echo "org.gradle.daemon=true" > ~/.gradle/gradle.properties
          echo "org.gradle.parallel=true" >> ~/.gradle/gradle.properties

      # Step 3: Build the APK
      - name: Build APK
        run: |
          # Clean the project and build the APK
          cd android && ./gradlew clean
          cd android && ./gradlew assembleRelease

      # Step 4: Upload the APK to Codemagic artifacts
      - name: Upload APK
        archive:
          path: "android/app/build/outputs/apk/release/app-release.apk"
          destination: "build/app-release.apk"
